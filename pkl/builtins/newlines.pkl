import "../Config.pkl"

newlines = new Config.Step {
  category = "Special Purpose"
  description = "Ensure files end with newline"
  glob = "**/*"
  stage = "<JOB_FILES>"
  check_first = true
  check_list_files = "hk util end-of-file-fixer {{files}}"
  fix = "hk util end-of-file-fixer --fix {{files}}"
  tests {
    ["adds newline"] {
      run = "fix"
      write { ["{{tmp}}/a.txt"] = "no-newline" }
      files = List("{{tmp}}/a.txt")
      expect { files { ["{{tmp}}/a.txt"] = "no-newline\n" } }
    }
  }
}
